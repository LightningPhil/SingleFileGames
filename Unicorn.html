<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Whack-A-Unicorn: Magical Edition</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@700&display=swap');

        :root {
            /* A slightly more magical purple/pink sky for Unicorns */
            --bg-gradient: radial-gradient(circle at center, #a29bfe 0%, #6c5ce7 100%);
            --primary: #fd79a8;
            --text: #2d3436;
        }

        body {
            margin: 0;
            padding: 0;
            background: var(--bg-gradient);
            font-family: 'Nunito', sans-serif;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            user-select: none;
            cursor: crosshair;
        }

        /* --- Header --- */
        header {
            text-align: center;
            padding-top: 15px;
            height: 90px;
            z-index: 20;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h1 {
            font-family: 'Fredoka One', cursive;
            font-size: 2.5rem;
            margin: 0;
            color: #fff;
            text-shadow: 0 4px 0 rgba(0,0,0,0.2);
            letter-spacing: 1px;
        }

        .stats-bar {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }

        .stat-box {
            background: #fff;
            padding: 5px 20px;
            border-radius: 50px;
            font-size: 1.2rem;
            color: var(--text);
            box-shadow: 0 4px 0 rgba(0,0,0,0.1);
            font-weight: 800;
            min-width: 100px;
            text-align: center;
        }

        /* --- Game Grid --- */
        .game-wrapper {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: 100%;
            padding-bottom: 20px;
        }

        .row {
            display: flex;
            justify-content: center;
            width: 100%;
            margin: 25px 0; /* Vertical spacing */
        }

        /* --- The Hole (Mask) --- */
        .hole {
            position: relative;
            width: 150px;
            height: 240px; 
            margin: 0 10px;
            overflow: hidden; 
            border-radius: 0 0 50px 50px;
        }

        /* --- The Unicorn --- */
        .unicorn-container {
            position: absolute;
            left: 50%;
            width: 140px; /* Slightly wider for mane */
            height: 350px; 
            top: 240px; /* Hidden */
            transform: translateX(-50%);
            transition: top 0.4s cubic-bezier(0.4, 2.3, 0.5, 1);
            z-index: 1;
        }

        .hole.up .unicorn-container {
            top: 10px; /* High visibility */
            cursor: pointer;
        }

        .hole.bonked .unicorn-container {
            top: 50px; /* Sinks slightly on hit */
            transition: top 0.1s ease-out;
            pointer-events: none;
        }

        /* --- The Bush --- */
        .bush-container {
            position: absolute;
            bottom: -20px; 
            left: -15%;
            width: 130%;
            height: 140px;
            z-index: 2;
            pointer-events: none;
            filter: drop-shadow(0 -2px 5px rgba(0,0,0,0.1));
        }

        /* --- ANIMATIONS & TYPES --- */
        .eyes-cross, .tongue-group, .spit-particle { display: none; }
        .acc-party, .acc-crown { display: none; }
        
        .unicorn-container.type-party .acc-party { display: block; }
        .unicorn-container.type-crown .acc-crown { display: block; }

        /* Bonked States */
        .hole.bonked .eyes-normal { display: none; }
        .hole.bonked .eyes-cross { display: block; }
        
        .hole.bonked .snout {
            animation: snout-puff 0.1s infinite alternate;
            transform-origin: center center;
        }
        
        .hole.bonked .tongue-group {
            display: block;
            animation: raspberry-tongue 0.08s infinite; 
            transform-origin: center top; 
        }

        .hole.bonked .spit-particle {
            display: block;
            animation: spit-fly 0.3s infinite;
        }

        @keyframes snout-puff {
            0% { transform: scale(1); }
            100% { transform: scale(1.1); }
        }

        @keyframes raspberry-tongue {
            0% { transform: scaleY(0.5) rotate(0deg); }
            25% { transform: scaleY(1.4) rotate(-10deg) scaleX(1.2); }
            50% { transform: scaleY(1.2) rotate(0deg) scaleX(1.1); }
            75% { transform: scaleY(1.4) rotate(10deg) scaleX(1.2); }
            100% { transform: scaleY(0.5) rotate(0deg); }
        }

        @keyframes spit-fly {
            0% { transform: translate(0,0) scale(0); opacity: 1; }
            100% { transform: translate(var(--tx), var(--ty)) scale(1); opacity: 0; }
        }

        /* --- Floating Score --- */
        .float-score {
            position: absolute;
            font-family: 'Fredoka One', cursive;
            font-size: 2.5rem;
            color: #fff;
            pointer-events: none;
            animation: floatUp 0.6s forwards;
            z-index: 100;
            text-shadow: 2px 2px 0 #000;
        }
        
        .float-score.score-2 { color: #fdcb6e; font-size: 3rem; }
        .float-score.score-3 { color: #ffd700; font-size: 3.5rem; text-shadow: 2px 2px 0 #d35400; }

        @keyframes floatUp {
            0% { opacity: 1; transform: translateY(0) scale(1); }
            100% { opacity: 0; transform: translateY(-80px) scale(1.2); }
        }

        /* --- OVERLAY & FORMS --- */
        .overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7);
            backdrop-filter: blur(8px);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 200;
            transition: opacity 0.3s;
        }
        .hidden { opacity: 0; pointer-events: none; }
        
        .overlay h2 {
            color: white; 
            font-family:'Fredoka One'; 
            font-size: 3.5rem; 
            margin: 0 0 20px 0;
            text-shadow: 0 4px 10px rgba(0,0,0,0.5);
        }

        .btn {
            background: var(--primary);
            border: 4px solid #fff;
            padding: 15px 50px;
            font-size: 2rem;
            font-family: 'Fredoka One', cursive;
            color: white;
            border-radius: 60px;
            cursor: pointer;
            box-shadow: 0 8px 0 #e84393;
            transition: all 0.1s;
        }
        .btn:active { transform: translateY(8px); box-shadow: none; }

        .leaderboard-container {
            background: white;
            padding: 20px;
            border-radius: 20px;
            width: 300px;
            text-align: center;
            margin-bottom: 20px;
        }
        .leaderboard-list { list-style: none; padding: 0; margin: 0; font-size: 1.2rem; }
        .leaderboard-item { display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px solid #eee; }
        .input-group { display: flex; flex-direction: column; align-items: center; gap: 15px; }
        input#username { padding: 15px; font-size: 1.5rem; border-radius: 10px; border: none; text-align: center; font-family: 'Nunito'; font-weight: bold; outline: none; }
        
        @media (max-width: 900px) {
            .hole { width: 100px; height: 160px; margin: 0 4px; border-radius: 0 0 30px 30px; }
            .unicorn-container { width: 100px; height: 250px; top: 160px; }
            .hole.up .unicorn-container { top: 10px; }
            .hole.bonked .unicorn-container { top: 30px; }
            .bush-container { height: 100px; bottom: -15px; }
            .row { margin: 15px 0; }
        }
    </style>
</head>
<body>

    <header>
        <h1>Whack-A-Unicorn</h1>
        <div class="stats-bar">
            <div class="stat-box">Score: <span id="score">0</span></div>
            <div class="stat-box">Time: <span id="timer">60</span>s</div>
            <div class="stat-box" style="color:#fd79a8">Best: <span id="high-score">0</span></div>
        </div>
    </header>

    <div class="game-wrapper">
        <div class="row">
            <div class="hole"><div class="unicorn-container"></div><div class="bush-container"></div></div>
            <div class="hole"><div class="unicorn-container"></div><div class="bush-container"></div></div>
            <div class="hole"><div class="unicorn-container"></div><div class="bush-container"></div></div>
            <div class="hole"><div class="unicorn-container"></div><div class="bush-container"></div></div>
        </div>
        <div class="row">
            <div class="hole"><div class="unicorn-container"></div><div class="bush-container"></div></div>
            <div class="hole"><div class="unicorn-container"></div><div class="bush-container"></div></div>
            <div class="hole"><div class="unicorn-container"></div><div class="bush-container"></div></div>
            <div class="hole"><div class="unicorn-container"></div><div class="bush-container"></div></div>
            <div class="hole"><div class="unicorn-container"></div><div class="bush-container"></div></div>
        </div>
    </div>

    <div class="overlay" id="overlay">
        <div id="start-content">
            <h2>Ready?</h2>
            <button class="btn" onclick="startGame()">PLAY!</button>
        </div>
        <div id="input-content" style="display:none;" class="input-group">
            <h2>NEW HIGH SCORE!</h2>
            <input type="text" id="username" placeholder="Enter Name" maxlength="8">
            <button class="btn" onclick="submitScore()">SAVE</button>
        </div>
        <div id="leaderboard-content" style="display:none; text-align: center;">
            <h2>GAME OVER</h2>
            <div class="leaderboard-container">
                <h3 style="font-family:'Fredoka One'; margin-bottom:10px;">TOP WHACKERS</h3>
                <ul class="leaderboard-list" id="leaderboard-list"></ul>
            </div>
            <button class="btn" onclick="resetToStart()">PLAY AGAIN</button>
        </div>
    </div>

    <script>
        /**
         * =========================================
         *  GAME CONFIGURATION
         * =========================================
         */
        const CONFIG = {
            GAME_DURATION: 60, 

            // SPEED SETTINGS (Slowed down by ~20%)
            START_MIN_TIME: 900, 
            START_MAX_TIME: 1600, 

            // Speed Limit
            END_MIN_TIME_LIMIT: 300, 
            END_MAX_TIME_LIMIT: 600, 

            // Speed Ramp decrement
            SPEED_DECREMENT: 15,

            // --- PROBABILITIES (1 in X) ---
            PROB_CROWN: 1 / 11,
            PROB_PARTY: 1 / 5,
            
            // --- DURATION MODIFIERS ---
            MOD_PARTY_TIME: 0.75, 
            MOD_CROWN_TIME: 0.5   
        };

        // --- ASSETS (SVGs) ---
        
        // UNICORN SVG
        const unicornSVG = `
        <svg viewBox="0 0 140 320" xmlns="http://www.w3.org/2000/svg">
            <g transform="translate(70, 20)"> 
                
                <!-- Rainbow Mane (Back) -->
                <path d="M-22,350 L-30,50 Q-40,20 -30,0 L25,50 L22,350 Z" fill="#a29bfe"/>
                <path d="M-22,350 L-30,50 L-25,50 Z" fill="#74b9ff"/>
                
                <!-- Neck (White) -->
                <path d="M-18,350 L-20,50 L20,50 L18,350 Z" fill="#ffffff" stroke="#dfe6e9" stroke-width="1"/>
                
                <!-- Head Group -->
                <g transform="translate(0, 50)">
                    
                    <!-- ACCESSORIES -->
                    <g class="acc-party" transform="translate(15, -65) rotate(15)">
                        <path d="M-15,10 L0,-40 L15,10 Z" fill="#fd79a8" stroke="#e84393" stroke-width="2"/>
                        <circle cx="0" cy="-40" r="4" fill="#ffeaa7"/>
                    </g>

                    <g class="acc-crown" transform="translate(0, -45)">
                        <!-- Crown sits around the horn -->
                        <path d="M-20,10 L-20,-15 L-10,0 L0,-20 L10,0 L20,-15 L20,10 Z" fill="#ffd700" stroke="#b7950b" stroke-width="2"/>
                        <circle cx="0" cy="-20" r="3" fill="#d63031"/>
                    </g>

                    <!-- Ears -->
                    <path d="M-20,-10 L-35,-40 L-10,-20 Z" fill="#ffffff" stroke="#dfe6e9" stroke-width="1"/>
                    <path d="M20,-10 L35,-40 L10,-20 Z" fill="#ffffff" stroke="#dfe6e9" stroke-width="1"/>
                    <path d="M-22,-15 L-28,-30 L-18,-20 Z" fill="#ffcccc"/> <!-- Inner ear -->
                    <path d="M22,-15 L28,-30 L18,-20 Z" fill="#ffcccc"/>

                    <!-- The HORN -->
                    <path d="M-5,-25 L0,-80 L5,-25 Z" fill="#ffeaa7" stroke="#fdcb6e" stroke-width="2"/>
                    <path d="M-3,-40 L3,-45 M-4,-55 L4,-60 M-2,-70 L2,-73" stroke="#fdcb6e" stroke-width="2" fill="none"/>

                    <!-- Face Base -->
                    <ellipse cx="0" cy="0" rx="30" ry="40" fill="#ffffff"/>
                    
                    <!-- Mane (Forelock) -->
                    <path d="M-10,-35 Q0,-50 10,-35 Q5,-20 0,-25 Q-5,-20 -10,-35" fill="#fd79a8"/>

                    <!-- Tongue & Snout Mechanics -->
                    <g class="tongue-group" transform="translate(0, 20)">
                         <path d="M-10,0 Q0,40 10,0" fill="#FF6B6B" stroke="#d63031" stroke-width="2" />
                         <path d="M0,0 L0,35" stroke="#d63031" stroke-width="1" fill="none"/>
                    </g>
                    <circle class="spit-particle" cx="-15" cy="40" r="3" fill="#74b9ff" style="--tx: -20px; --ty: 20px;" />
                    <circle class="spit-particle" cx="15" cy="40" r="2" fill="#74b9ff" style="--tx: 20px; --ty: 15px;" />
                    <circle class="spit-particle" cx="0" cy="50" r="2.5" fill="#74b9ff" style="--tx: 0px; --ty: 30px;" />
                    
                    <g class="snout">
                        <ellipse cx="0" cy="20" rx="22" ry="18" fill="#ffcccc"/> <!-- Pink Snout -->
                        <ellipse cx="-8" cy="18" rx="3" ry="5" fill="#636e72" transform="rotate(-10)"/> <!-- Nostril -->
                        <ellipse cx="8" cy="18" rx="3" ry="5" fill="#636e72" transform="rotate(10)"/>
                    </g>

                    <g class="eyes-normal">
                        <circle cx="-14" cy="-10" r="6" fill="#2d3436"/>
                        <circle cx="-16" cy="-12" r="2" fill="white"/>
                        <circle cx="14" cy="-10" r="6" fill="#2d3436"/>
                        <circle cx="12" cy="-12" r="2" fill="white"/>
                    </g>
                    <g class="eyes-cross">
                        <path d="M-18,-14 L-10,-6 M-18,-6 L-10,-14" stroke="#2d3436" stroke-width="4" stroke-linecap="round"/>
                        <path d="M10,-14 L18,-6 M10,-6 L18,-14" stroke="#2d3436" stroke-width="4" stroke-linecap="round"/>
                    </g>
                </g>
            </g>
        </svg>`;

        // BUSH SVG (Magical Edition)
        const bushSVG = `
        <svg viewBox="0 0 200 130" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="none">
            <defs>
                <linearGradient id="gradBush" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#00cec9;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#0984e3;stop-opacity:1" />
                </linearGradient>
            </defs>
            <path d="M20,130 L180,130 C180,130 200,90 180,60 C190,30 150,0 100,20 C50,0 10,30 20,60 C0,90 20,130 20,130 Z" fill="url(#gradBush)"/>
            <path d="M100,20 C50,0 10,30 20,60" fill="none" stroke="rgba(255,255,255,0.2)" stroke-width="3" stroke-linecap="round"/>
            <circle cx="40" cy="80" r="5" fill="#fd79a8" opacity="0.8"/>
            <circle cx="160" cy="50" r="4" fill="#ffeaa7" opacity="0.8"/>
            <circle cx="120" cy="90" r="3" fill="#a29bfe" opacity="0.8"/>
        </svg>`;

        document.querySelectorAll('.unicorn-container').forEach(el => el.innerHTML = unicornSVG);
        document.querySelectorAll('.bush-container').forEach(el => el.innerHTML = bushSVG);

        // --- GAME LOGIC ---
        const holes = document.querySelectorAll('.hole');
        const scoreBoard = document.querySelector('#score');
        const highScoreBoard = document.querySelector('#high-score');
        const timerDisplay = document.querySelector('#timer');
        const overlay = document.getElementById('overlay');
        const startContent = document.getElementById('start-content');
        const inputContent = document.getElementById('input-content');
        const leaderboardContent = document.getElementById('leaderboard-content');
        const leaderboardList = document.getElementById('leaderboard-list');
        const usernameInput = document.getElementById('username');
        const unicornElements = document.querySelectorAll('.unicorn-container');

        let lastHole;
        let timeUp = false;
        let score = 0;
        let countdown;
        let minTime = CONFIG.START_MIN_TIME;
        let maxTime = CONFIG.START_MAX_TIME;
        
        // --- STORAGE & LEADERBOARD (Updated Key) ---
        function getLeaderboard() {
            const stored = localStorage.getItem('whackUnicornScores');
            return stored ? JSON.parse(stored) : [];
        }
        function saveLeaderboard(scores) { localStorage.setItem('whackUnicornScores', JSON.stringify(scores)); }
        function isHighScore(currentScore) {
            const scores = getLeaderboard();
            if (scores.length < 5) return true;
            return currentScore > scores[scores.length - 1].score;
        }
        function displayTopScore() {
            const scores = getLeaderboard();
            highScoreBoard.textContent = scores.length > 0 ? scores[0].score : 0;
        }
        displayTopScore();

        function renderLeaderboard() {
            const scores = getLeaderboard();
            if(scores.length === 0) {
                leaderboardList.innerHTML = '<li class="leaderboard-item">No scores yet!</li>';
                return;
            }
            leaderboardList.innerHTML = scores.map((s, i) => `
                <li class="leaderboard-item">
                    <span>${i+1}. ${s.name}</span>
                    <span>${s.score}</span>
                </li>
            `).join('');
        }

        // --- AUDIO ---
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        const audioCtx = new AudioContext();

        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            if (type === 'pop') {
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(300, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(600, audioCtx.currentTime + 0.1);
                gainNode.gain.setValueAtTime(0.05, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.1);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.1);
            } else if (type === 'raspberry') {
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(100, audioCtx.currentTime);
                osc.frequency.linearRampToValueAtTime(50, audioCtx.currentTime + 0.3);
                const ampOsc = audioCtx.createOscillator();
                ampOsc.type = 'square';
                ampOsc.frequency.value = 25; 
                const ampGain = audioCtx.createGain();
                ampGain.gain.value = 0.5;
                gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
                gainNode.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.3);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.3);
            }
        }

        // --- GAMEPLAY ---

        function randomTime(min, max) {
            return Math.round(Math.random() * (max - min) + min);
        }

        function randomHole(holes) {
            const idx = Math.floor(Math.random() * holes.length);
            const hole = holes[idx];
            if (hole === lastHole) return randomHole(holes);
            lastHole = hole;
            return hole;
        }

        function peep() {
            let time = randomTime(minTime, maxTime);
            const hole = randomHole(holes);
            const unicorn = hole.querySelector('.unicorn-container');
            
            const rand = Math.random();
            let type = 'normal';

            unicorn.classList.remove('type-party', 'type-crown');

            if (rand < CONFIG.PROB_CROWN) {
                type = 'crown';
                unicorn.classList.add('type-crown');
                time = time * CONFIG.MOD_CROWN_TIME;
            } else if (rand < (CONFIG.PROB_CROWN + CONFIG.PROB_PARTY)) {
                type = 'party';
                unicorn.classList.add('type-party');
                time = time * CONFIG.MOD_PARTY_TIME;
            }

            hole.classList.add('up');
            playSound('pop');

            setTimeout(() => {
                hole.classList.remove('up');
                if (!timeUp) peep();
            }, time);
        }

        function startGame() {
            scoreBoard.textContent = 0;
            score = 0;
            timeUp = false;
            minTime = CONFIG.START_MIN_TIME;
            maxTime = CONFIG.START_MAX_TIME;
            
            startContent.style.display = 'none';
            inputContent.style.display = 'none';
            leaderboardContent.style.display = 'none';
            overlay.classList.add('hidden');
            
            let timeLeft = CONFIG.GAME_DURATION;
            timerDisplay.textContent = timeLeft;
            peep();

            countdown = setInterval(() => {
                timeLeft--;
                timerDisplay.textContent = timeLeft;
                if(timeLeft <= 0) {
                    clearInterval(countdown);
                    timeUp = true;
                    endGame();
                }
            }, 1000);
        }

        function endGame() {
            overlay.classList.remove('hidden');
            if (isHighScore(score) && score > 0) {
                inputContent.style.display = 'flex';
                usernameInput.value = '';
                usernameInput.focus();
            } else {
                showLeaderboardScreen();
            }
        }

        function submitScore() {
            const name = usernameInput.value.trim() || "Anon";
            const scores = getLeaderboard();
            const newEntry = { name: name, score: score };
            scores.push(newEntry);
            scores.sort((a, b) => b.score - a.score);
            scores.splice(5); 
            saveLeaderboard(scores);
            displayTopScore();
            inputContent.style.display = 'none';
            showLeaderboardScreen();
        }

        function showLeaderboardScreen() {
            startContent.style.display = 'none';
            renderLeaderboard();
            leaderboardContent.style.display = 'block';
        }

        function resetToStart() {
            leaderboardContent.style.display = 'none';
            startContent.style.display = 'block';
        }

        function whack(e) {
            if(!e.isTrusted) return;
            const hole = this.parentNode;
            if(hole.classList.contains('bonked')) return;

            const unicorn = this;
            let points = 1;
            let labelClass = "";

            if (unicorn.classList.contains('type-crown')) {
                points = 3;
                labelClass = "score-3";
            } else if (unicorn.classList.contains('type-party')) {
                points = 2;
                labelClass = "score-2";
            }

            score += points;
            scoreBoard.textContent = score;
            
            hole.classList.remove('up');
            hole.classList.add('bonked');
            playSound('raspberry');

            const float = document.createElement('div');
            float.classList.add('float-score');
            if(labelClass) float.classList.add(labelClass);
            float.textContent = "+" + points;
            
            const x = e.clientX || hole.getBoundingClientRect().left + 50;
            const y = e.clientY || hole.getBoundingClientRect().top;
            float.style.left = `${x}px`;
            float.style.top = `${y}px`;
            document.body.appendChild(float);
            setTimeout(() => float.remove(), 800);

            if (minTime > CONFIG.END_MIN_TIME_LIMIT) minTime -= CONFIG.SPEED_DECREMENT;
            if (maxTime > CONFIG.END_MAX_TIME_LIMIT) maxTime -= CONFIG.SPEED_DECREMENT;

            setTimeout(() => {
                hole.classList.remove('bonked');
            }, 400);
        }

        unicornElements.forEach(g => {
            g.addEventListener('mousedown', whack);
            g.addEventListener('touchstart', (e) => { e.preventDefault(); whack.call(g, e); });
        });

    </script>
</body>
</html>